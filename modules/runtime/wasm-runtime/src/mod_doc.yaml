name: "runtime.wasm"
version: "0.1.0"
author: "Bo Maryniuk"
description: Wasm runtime module.

# Options, flags, switches
options:
#  - name: rt.list
#    description: "List of available Wasm scripts, ready to be called as modules."
#
#  - name: rt.logs
#    description: "Enable logging from Wasm scripts to SysInspect logs."
#
#  - name: rt.sandbox
#    description: "Run Wasm binaries in sandboxed environment."

# Keyword arguments
arguments:
  - name: rt.mod
    type: string
    required: true
    description: "The name of a Wasm binary to be executed. This binary will be looked up in the predefined configured scripts directory."

  - name: rt.rootfs
    type: string
    required: false
    description: |
      Path to the root filesystem directory that will be mounted
      inside the Wasm runtime environment. This allows the Wasm binary
      to access files and directories within the specified rootfs.

  - name: "[ANY]"
    type: string
    required: false
    description: |
      Additional arguments that will be passed to the Wasm binary being executed. These arguments will be available within the Wasm binary
      as global variables.

examples:
  - description: "Call a Wasm binary named 'hello_world.wasm' so it will greet Germany"
    code: |
      {
        "opts": [],
        "arguments": {
          "rt.mod": "hello_world",
          "name": "Germany"
        }
      }

# Description of additional data format
returns:
  # Output data structure as a sample
  # Happens by default
  fill:
    :description: |
      Returns just a regular text of the command STDOUT.
    retcode: 0
    message: "Called Wasm binary successfully."
    data:
      changed: false

manpage: |
  This module allows executing Wasm binaries as modules within
  the SysInspect framework. The module supports passing additional
  arguments to the Wasm binary, which will be available as global
  variables within the binary.

  Important to keep the following directory structure for your
  Wasm binaries and their dependencies. The [W::b]main Wasm binaries[N]
  (modules) for this runtime must be installed in the following directory:
  [y::]${SYSINSPECT_SHARELIB_ROOT}[Y::]/lib/runtime/wasm/[N]

