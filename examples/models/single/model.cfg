name: "Cfg Mgmt Example: call a single native module"
version: "0.1"
description: |
  Single module call

maintainer: Bo Maryniuk <still@javascriptsucks.com>
checkbook:
relations:
entities:
  - call
  - wasm
  - info

actions:
  rs-reader:
    descr: "Go-based module calls uname -a"
    module: runtime.wasm-runtime
    bind:
      - wasm
    state:
      $:
        args:
          rt.mod: caller

  info:
    descr: Printer to STDOUT
    module: sys.run
    bind:
      - info
    state:
      $:
        args:
        {% if context.osversion is defined %}
          cmd: >-
              echo "Previous module call returned {{ context.osversion }} as VERSION ID"
        {% else %}
           cmd: >-
              echo "No context for osversion, just hello world"
        {% endif %}
  ping:
    descr: Information module
    module: sys.run
    bind:
      - call

    state:
      $:
        opts:
        args:
          cmd: "uname -a"
        conditions:
          uid: 65432
          gid: 65432
          working-dir: "/tmp"
          working-disk: 1Mb

constraints:

events:
  $/$/$/$:
    handlers:
      - console-logger
      - outcome-logger

    console-logger:
      concise: false
      prefix: Single Call

    outcome-logger:
      prefix: Single Call
