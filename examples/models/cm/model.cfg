name: Configuration management example
version: "0.1"
description: |
  Configuration management example model

maintainer: John Smith <js@javascriptsucks.com>
checkbook:
relations:
entities:
  file-ops:
    claims:
      $:
        - netconfig:
            name: /tmp/networks.foo

actions:
  copy-netconfig:
    descr: Copy network cfg to /tmp
    module: fs.file
    bind:
      - file-ops

    state:
      $:
        opts:
          - fill
        args:
          name: "claim(netconfig.name)"
          pull: "/networks"

  del-netconfig:
    descr: Delete network cfg file
    module: fs.file
    bind:
      - file-ops
    state:
      $:
        opts:
          - delete
        args:
          name: "claim(netconfig.name)"

constraints:
  copy-netconfig:
    descr: Networks config should be copied again
    entities:
      - file-ops

    all:
      $:
        - fact: changed
          equals: true

  del-netconfig:
    descr: Networks config should be removed
    entities:
      - file-ops

    all:
      $:
        - fact: changed
          equals: true

events:
  $/$/$/$:
    handler:
      - console-logger
      - outcome-logger

    console-logger:
      concise: false
      prefix: CfgMgmt

    outcome-logger:
      prefix: CfgMgmt
